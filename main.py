import requests
import time
import random
def main():
    headers = {
        'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/106.0.5249.62 Safari/537.36',
    }
    session = requests.session()
    r = session.get(f'https://{storename}/', headers=headers)
    x = session.get(f'https://{storename}/cart.js?ba_request=1', headers=headers).json()
    timestamp = int(round(time.time() * 1000))
    token = x['token'] + str(timestamp)
    print(token)
    oses = ['Windows', 'Mac OS', 'iPhone', 'iPad', 'Android']
    browsers = ['Chrome', 'Firefox', 'Opera', 'Mozilla']

    data = {
        "widget_id": {widgetid},
        "shop": "neonworld-6338.myshopify.com",
        "visitor_token": token,
        "subscriber": {
            "customer_id": None,
            "email": str(random.randint(10000, 999999))+'@gmail.com',
            "timezone": 0,
            "os": random.choice(oses),
            "browser": random.choice(browsers)
        }
    }
    f = session.patch(f'https://{storename}/apps/ba-pop/subscribers', headers=headers, json=data)
    print(f.status_code)
    print
    if f.status_code == 200 and f.json()['success'] == True:
        print('Success')
        print(f.json()['discount_code'])
    else:
        print('Failed')
        print(f.json())

while True:
    main()
    time.sleep(0.1)
